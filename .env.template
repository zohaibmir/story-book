# Environment Variables for Latest AI Models

## Current Configuration (DALL-E 3 - Working)
OPENAI_API_KEY=your_openai_api_key_here

## New Azure OpenAI Configuration (GPT-image-1 - Add these)
# Azure OpenAI credentials for GPT-image-1 access
AZURE_OPENAI_API_KEY=your_azure_openai_api_key
AZURE_OPENAI_ENDPOINT=https://your-resource-name.openai.azure.com
AZURE_OPENAI_DEPLOYMENT_NAME=gpt-image-1
AZURE_OPENAI_API_VERSION=2025-04-01-preview

## Image Analysis (Character Descriptor)
# Enable or disable sending uploaded character images (base64 inline) to OpenAI for descriptor extraction
ENABLE_IMAGE_ANALYSIS=true
# Max allowed image size in bytes for analysis (default 5MB)
IMAGE_ANALYSIS_MAX_BYTES=5000000
# Model used for multimodal (text+image) analysis
IMAGE_ANALYSIS_MODEL=gpt-4o
# Request timeout (ms) for analysis calls
IMAGE_ANALYSIS_TIMEOUT_MS=45000

## Generated Image Persistence
# If true, generated images (DALL-E / GPT-image-1) are saved to disk and served from /generated
SAVE_GENERATED_IMAGES=true
# Directory (relative to backend root) where generated images are stored
GENERATED_IMAGE_DIR=generated
# Output format when saving base64 images (png or jpg)
GENERATED_IMAGE_FORMAT=png

## Native (Non-Azure) GPT-Image-1 Toggle
# Enable use of native OpenAI gpt-image-1 edits endpoint (requires OPENAI_API_KEY)
ENABLE_NATIVE_GPT_IMAGE1=false
# Optional timeout (ms) for native image edit requests
IMAGE_EDIT_TIMEOUT_MS=120000

## Async Illustration Generation
# If true, story endpoint returns quickly and illustrations are generated in background
ASYNC_ILLUSTRATIONS=false

## Generated Images Retention Policy
# Maximum number of generated image files to retain (oldest pruned first). 0 = unlimited
GENERATED_IMAGE_MAX_FILES=0
# Maximum cumulative size in megabytes for generated images directory. 0 = unlimited
GENERATED_IMAGE_MAX_MB=0

## Setup Instructions

### 1. Apply for GPT-image-1 Access
- Visit: https://aka.ms/oai/gptimage1access
- Fill out the limited access form
- Wait for approval (may take several days)

### 2. Once Approved - Create Azure OpenAI Resource
- Go to Azure Portal
- Create new Azure OpenAI resource
- Deploy GPT-image-1 model (when available)
- Get API key and endpoint

### 3. Update Environment Variables
- Add the Azure OpenAI variables above to your .env file
- Restart your application

### 4. Test the New Functionality
```bash
curl -X POST http://localhost:5000/api/images/generate-with-gpt-image-1 \
  -H "Content-Type: application/json" \
  -d '{
    "character": {
      "name": "Test Character",
      "age": 10,
      "personality": ["brave", "curious"],
      "imageUrl": "/uploads/your-character-image.jpg"
    },
    "sceneDescription": "Character in a magical forest",
    "storyTitle": "Test Story"
  }'
```

## Feature Detection
The system automatically detects if GPT-image-1 is available:
- If configured and available: Uses GPT-image-1 with actual image reference
- If not available: Falls back to DALL-E 3 with enhanced text descriptions

## Current Status
- âœ… DALL-E 3: Fully working with text-based consistency
- ðŸ”„ GPT-image-1: Ready for integration (pending access approval)
- âœ… GPT-4 Vision: Working for character image analysis
- âœ… Hybrid Service: Automatic fallback system implemented